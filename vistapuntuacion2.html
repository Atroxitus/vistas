<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Datos</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>

<body>

    <h2>Tabla de Datos</h2>
    <input type="text" id="inputId" placeholder="Ingrese el ID a actualizar">


    <table id="tablaDatos">
        <thead>
            <tr>
                <th>idp</th>
                <th>Personas y Cultura Digital</th>
                <th>Procesos de la Entidad</th>
                <th>Datos Digitales y Analytics</th>
                <th>Tecnología Digital</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se cargarán los datos desde la base de datos -->
        </tbody>
    </table>
    <button onclick="actualizarDatoss()">Actualizar Datos</button>

    <script>
        // Función para cargar los datos desde la base de datos
        function cargarDatos() {
            fetch(`http://localhost:3000/datos-tabla`)
                .then(response => response.json())
                .then(data => {
                    const tablaBody = document.querySelector('#tablaDatos tbody');
                    tablaBody.innerHTML = '';

                    data.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                        <td>${row.idp}</td>
                        <td contenteditable>${row.personas_y_cultura_digital}</td>
                        <td contenteditable>${row.procesos_de_la_entidad}</td>
                        <td contenteditable>${row.datos_digitales_y_analytics}</td>
                        <td contenteditable>${row.tecnologia_digital}</td>
                        <td><button onclick="eliminarDato(${row.idp})">Eliminar</button></td>
                    `;
                        tablaBody.appendChild(tr);
                    });
                });
        }

        // Función para eliminar un dato
        function eliminarDato(id) {
            if (confirm('¿Estás seguro de que deseas eliminar este dato?')) {
                fetch(`http://localhost:3000/eliminar/${id}`, {
                    method: 'DELETE'
                })

                    .then(data => {
                        if (data.success) {
                            cargarDatos();
                        } else {
                            alert('datos eliminados');
                        }
                    });
            }
        }


        function actualizarDatoss() {
            const idp = document.getElementById('inputId').value;
        if (!idp) {
            alert('No se ha proporcionado un ID válido.');
            return;
        }

            const tablaBody = document.querySelector('#tablaDatos tbody');
            const rows = tablaBody.querySelectorAll('tr');

            const updatedData = [];

            rows.forEach(row => {
                const id = row.querySelector('td:first-child').textContent;
                const personas = row.querySelector('td:nth-child(2)').textContent;
                const procesos = row.querySelector('td:nth-child(3)').textContent;
                const datos = row.querySelector('td:nth-child(4)').textContent;
                const tecnologia = row.querySelector('td:nth-child(5)').textContent;

                updatedData.push({idp: id, personas_y_cultura_digital: personas, procesos_de_la_entidad: procesos, datos_digitales_y_analytics: datos, tecnologia_digital: tecnologia });
            });

            
           

            fetch(`http://localhost:3000/actualizar-dato/${idp}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            })
                
                .then(response => {
                    if (response.ok) {
                        alert('Datos actualizados exitosamente.');
                    } else {
                        alert('Error al actualizar los datos.');
                    }
                })
                 .catch(error => {
        console.error('Error al enviar la solicitud:', error);
        alert('Error al enviar la solicitud.');
    });
        }
        // Cargar los datos al cargar la página
        cargarDatos();
    </script>

</body>

</html>